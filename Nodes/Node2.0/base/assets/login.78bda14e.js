import{A as x,h as N,a0 as T,u as M,a3 as O,ay as P,j as l,k as s,G as t,a5 as a,aU as p,I as r,J as d,a8 as q,N as J,O as L,aV as K,U as W,o as c,aW as w,K as m,aX as g,aY as j}from"./index.f8dd1a1d.js";import{b as H,l as $,a as G,E as X,c as h,r as C}from"./login-title.ca10d113.js";import{E as Y,a as z,b as E,R as B,w as f,s as Q}from"./index.022fdd97.js";import"./event.7d53d36c.js";import"./isEqual.4f2dd677.js";const y=_=>(J("data-v-7589b93f"),_=_(),L(),_),Z=["src"],ee=["src"],te={class:"login-title"},oe=y(()=>s("div",{class:"title"},"\u4E91\u4E0A\u7535\u79D1\u9662",-1)),se=y(()=>s("div",{class:"tips"},"CLOUD ELECTRIC POWER RESEARCH INSTITUTE",-1)),ie=["src"],ue={class:"login-container"},ne={class:"login-box"},ae={class:"login-form"},le={class:"login-form-tips",initial:{opacity:0,y:100},enter:{opacity:1,y:0,transition:{delay:100}}},re=m(" Welcome\uFF01 "),de=[re],ce={class:"login-form-title",initial:{opacity:0,y:100},enter:{opacity:1,y:0,transition:{delay:100}}},me=m(" \u6B22\u8FCE\uFF0C\u8BF7\u767B\u5F55\u7CFB\u7EDF "),pe=[me],_e={class:"input-group user focus",initial:{opacity:0,y:100},enter:{opacity:1,y:0,transition:{delay:200}}},fe={class:"input-group pwd focus",initial:{opacity:0,y:100},enter:{opacity:1,y:0,transition:{delay:300}}},ye={class:"login-form-check",initial:{opacity:0,y:100},enter:{opacity:1,y:0,transition:{delay:200}}},Fe=m(" \u767B\u5F55 "),ge=[Fe],Ee={initial:{opacity:0,y:100},enter:{opacity:1,y:0,transition:{delay:200}},class:"login-form-link"},Be=m(" \u70B9\u51FB\u67E5\u770B"),ke=y(()=>s("span",null,"\u300A\u4E91\u4E0A\u7535\u79D1\u9662\u7528\u6237\u534F\u8BAE\u300B",-1)),we=[Be,ke],he=y(()=>s("div",{class:"login-form-other"},[s("span",null,"\u5FD8\u8BB0\u5BC6\u7801"),s("span",null,"\u6CE8\u518C\u8D26\u53F7")],-1)),Ce={class:"dialog-footer"},Se=m("\u53D6\u6D88"),ve=m("\u786E\u5B9A"),Ie=N({setup(_){const S=T(),v=M();let e=O({loginUserId:"",password:"",isChecked:!1,ak:"",sk:"",kind:"psw_ident",requestSource:"pc",visible:!1,editForm:{oldSk:"",sk:"",confirmSk:""}});const F=async(n,i)=>{const{result:{publicExponent:o,publicModulus:u}}=await i();B.setMaxDigits(130);const R=new B.RSAKeyPair(o,"",u);return n.length<32?B.encryptedString(R,encodeURIComponent(n)):n},I=async()=>{e.password=await F(e.password,g),e.ak=e.loginUserId,e.sk=e.password;const{result:n}=await K(e),i=n.map(o=>{if(o.relAppId)return{appName:o.systemName,appId:o.relAppId,tenantId:o.relTenantId,authCode:o.authCode,relMenuId:o.relAppId,relMenuName:o.systemName,mark:o.ident||"",menuVirtual:"0",path:o.path,route:o.route}});if(n&&n.length>0&&v.$patch({system:n[0].accessTokenResultVO}),window.localStorage.setItem("main-token",JSON.stringify(n[0].accessTokenResultVO)),n[0].firstLogin==0){e.visible=!0;return}window.localStorage.setItem("asyncRoutes",JSON.stringify(i.filter(o=>o))),window.localStorage.setItem("accountApps",JSON.stringify(i.filter(o=>o))),W().changeSetting(),window.localStorage.setItem("currentRoles",n[0].currentRole),S.push("/main")};function k(){e.editForm.oldSk="",e.editForm.sk="",e.editForm.confirmSk="",e.visible=!1}const A=async()=>{if(!e.editForm.oldSk){f("\u65E7\u5BC6\u7801\u4E0D\u80FD\u4E3A\u7A7A");return}if(!e.editForm.sk){f("\u65B0\u5BC6\u7801\u4E0D\u80FD\u4E3A\u7A7A");return}if(!e.editForm.confirmSk){f("\u786E\u8BA4\u5BC6\u7801\u4E0D\u80FD\u4E3A\u7A7A");return}if(e.editForm.confirmSk!==e.editForm.sk){f("\u65B0\u5BC6\u7801\u4E0E\u786E\u8BA4\u5BC6\u7801\u4E0D\u4E00\u81F4");return}const n={oldSk:await F(e.editForm.oldSk,g),sk:await F(e.editForm.sk,g)};(await j(n)).statusCode==="200"&&(Q("\u4FEE\u6539\u6210\u529F\uFF0C\u8BF7\u91CD\u65B0\u767B\u5F55"),e.loginUserId="",e.password="",e.ak="",e.sk="",k())};function b(){h(document.querySelector(".user"),"focus")}function D(){e.loginUserId.length===0&&C(document.querySelector(".user"),"focus")}function U(){h(document.querySelector(".pwd"),"focus")}function V(){e.password.length===0&&C(document.querySelector(".pwd"),"focus")}return(n,i)=>{const o=P("motion");return c(),l(q,null,[s("img",{src:t(H),class:"wave"},null,8,Z),s("img",{src:t($),class:"login-image-title"},null,8,ee),s("div",te,[oe,se,s("img",{src:t(G),class:"login-image"},null,8,ie)]),s("div",ue,[s("div",ne,[s("div",ae,[a((c(),l("div",le,de)),[[o]]),a((c(),l("h2",ce,pe)),[[o]]),a((c(),l("div",_e,[s("div",null,[a(s("input",{type:"text",class:"input",placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u540D","onUpdate:modelValue":i[0]||(i[0]=u=>t(e).loginUserId=u),onFocus:b,onBlur:D},null,544),[[p,t(e).loginUserId]])])])),[[o]]),a((c(),l("div",fe,[s("div",null,[a(s("input",{type:"password",class:"input",placeholder:"\u8BF7\u8F93\u5165\u5BC6\u7801","onUpdate:modelValue":i[1]||(i[1]=u=>t(e).password=u),onFocus:U,onBlur:V},null,544),[[p,t(e).password]])])])),[[o]]),a((c(),l("div",ye,[r(t(X),{modelValue:t(e).isChecked,"onUpdate:modelValue":i[2]||(i[2]=u=>t(e).isChecked=u),label:"\u8BB0\u4F4F\u5BC6\u7801"},null,8,["modelValue"])])),[[o]]),a((c(),l("button",{class:"btn",initial:{opacity:0,y:10},enter:{opacity:1,y:0,transition:{delay:400}},onClick:I},ge)),[[o]]),a((c(),l("div",Ee,we)),[[o]]),he])])]),r(t(Y),{modelValue:t(e).visible,"onUpdate:modelValue":i[6]||(i[6]=u=>t(e).visible=u),"show-close":!1,title:"\u4FEE\u6539\u5BC6\u7801"},{footer:d(()=>[s("span",Ce,[r(t(w),{onClick:k},{default:d(()=>[Se]),_:1}),r(t(w),{type:"primary",onClick:A},{default:d(()=>[ve]),_:1})])]),default:d(()=>[r(t(z),{model:t(e).editForm,"label-width":"120px",class:"edit-form"},{default:d(()=>[r(t(E),{label:"\u65E7\u5BC6\u7801"},{default:d(()=>[a(s("input",{"onUpdate:modelValue":i[3]||(i[3]=u=>t(e).editForm.oldSk=u),type:"password"},null,512),[[p,t(e).editForm.oldSk]])]),_:1}),r(t(E),{label:"\u65B0\u5BC6\u7801"},{default:d(()=>[a(s("input",{"onUpdate:modelValue":i[4]||(i[4]=u=>t(e).editForm.sk=u),type:"password"},null,512),[[p,t(e).editForm.sk]])]),_:1}),r(t(E),{label:"\u786E\u8BA4\u5BC6\u7801"},{default:d(()=>[a(s("input",{"onUpdate:modelValue":i[5]||(i[5]=u=>t(e).editForm.confirmSk=u),type:"password"},null,512),[[p,t(e).editForm.confirmSk]])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])],64)}}});var xe=x(Ie,[["__scopeId","data-v-7589b93f"],["__file","E:/project/\u4E3B\u5DE5\u7A0B/fin-main-app/src/views/login.vue"]]);export{xe as default};
