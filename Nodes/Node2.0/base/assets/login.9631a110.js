var w=(p,C,_)=>new Promise((e,f)=>{var S=l=>{try{F(_.next(l))}catch(g){f(g)}},B=l=>{try{F(_.throw(l))}catch(g){f(g)}},F=l=>l.done?e(l.value):Promise.resolve(l.value).then(S,B);F((_=_.apply(p,C)).next())});import{A as N,h as T,a0 as M,u as O,a3 as P,ay as q,j as r,k as s,G as o,a5 as a,aU as E,I as d,J as c,a8 as J,N as L,O as K,aV as W,U as j,o as m,aW as b,K as y,aX as v,aY as H}from"./index.5bf7a2f0.js";import{b as $,l as G,a as X,E as Y,c as D,r as U}from"./login-title.aa0c25cb.js";import{E as z,a as Q,b as I,R as A}from"./RSA.d8f9f07b.js";import{w as k,s as Z}from"./index.727b917e.js";import"./event.7d53d36c.js";import"./isEqual.80be9e83.js";const h=p=>(L("data-v-7589b93f"),p=p(),K(),p),ee=["src"],oe=["src"],te={class:"login-title"},se=h(()=>s("div",{class:"title"},"\u4E91\u4E0A\u7535\u79D1\u9662",-1)),ie=h(()=>s("div",{class:"tips"},"CLOUD ELECTRIC POWER RESEARCH INSTITUTE",-1)),ue=["src"],ne={class:"login-container"},ae={class:"login-box"},le={class:"login-form"},re={class:"login-form-tips",initial:{opacity:0,y:100},enter:{opacity:1,y:0,transition:{delay:100}}},de=y(" Welcome\uFF01 "),ce=[de],me={class:"login-form-title",initial:{opacity:0,y:100},enter:{opacity:1,y:0,transition:{delay:100}}},pe=y(" \u6B22\u8FCE\uFF0C\u8BF7\u767B\u5F55\u7CFB\u7EDF "),_e=[pe],fe={class:"input-group user focus",initial:{opacity:0,y:100},enter:{opacity:1,y:0,transition:{delay:200}}},ye={class:"input-group pwd focus",initial:{opacity:0,y:100},enter:{opacity:1,y:0,transition:{delay:300}}},Fe={class:"login-form-check",initial:{opacity:0,y:100},enter:{opacity:1,y:0,transition:{delay:200}}},ge=y(" \u767B\u5F55 "),Ee=[ge],Be={initial:{opacity:0,y:100},enter:{opacity:1,y:0,transition:{delay:200}},class:"login-form-link"},we=y(" \u70B9\u51FB\u67E5\u770B"),ke=h(()=>s("span",null,"\u300A\u4E91\u4E0A\u7535\u79D1\u9662\u7528\u6237\u534F\u8BAE\u300B",-1)),he=[we,ke],Ce=h(()=>s("div",{class:"login-form-other"},[s("span",null,"\u5FD8\u8BB0\u5BC6\u7801"),s("span",null,"\u6CE8\u518C\u8D26\u53F7")],-1)),Se={class:"dialog-footer"},ve=y("\u53D6\u6D88"),Ie=y("\u786E\u5B9A"),Ae=T({setup(p){const C=M(),_=O();let e=P({loginUserId:"",password:"",isChecked:!1,ak:"",sk:"",kind:"psw_ident",requestSource:"pc",visible:!1,editForm:{oldSk:"",sk:"",confirmSk:""}});const f=(n,i)=>w(this,null,function*(){const{result:{publicExponent:t,publicModulus:u}}=yield i();A.setMaxDigits(130);const x=new A.RSAKeyPair(t,"",u);return n.length<32?A.encryptedString(x,encodeURIComponent(n)):n}),S=()=>w(this,null,function*(){e.password=yield f(e.password,v),e.ak=e.loginUserId,e.sk=e.password;const{result:n}=yield W(e),i=n.map(t=>{if(t.relAppId)return{appName:t.systemName,appId:t.relAppId,tenantId:t.relTenantId,authCode:t.authCode,relMenuId:t.relAppId,relMenuName:t.systemName,mark:t.ident||"",menuVirtual:"0",path:t.path,route:t.route}});if(n&&n.length>0&&_.$patch({system:n[0].accessTokenResultVO}),window.localStorage.setItem("main-token",JSON.stringify(n[0].accessTokenResultVO)),n[0].firstLogin==0){e.visible=!0;return}window.localStorage.setItem("asyncRoutes",JSON.stringify(i.filter(t=>t))),window.localStorage.setItem("accountApps",JSON.stringify(i.filter(t=>t))),j().changeSetting(),window.localStorage.setItem("currentRoles",n[0].currentRole),C.push("/main/welcome")});function B(){e.editForm.oldSk="",e.editForm.sk="",e.editForm.confirmSk="",e.visible=!1}const F=()=>w(this,null,function*(){if(!e.editForm.oldSk){k("\u65E7\u5BC6\u7801\u4E0D\u80FD\u4E3A\u7A7A");return}if(!e.editForm.sk){k("\u65B0\u5BC6\u7801\u4E0D\u80FD\u4E3A\u7A7A");return}if(!e.editForm.confirmSk){k("\u786E\u8BA4\u5BC6\u7801\u4E0D\u80FD\u4E3A\u7A7A");return}if(e.editForm.confirmSk!==e.editForm.sk){k("\u65B0\u5BC6\u7801\u4E0E\u786E\u8BA4\u5BC6\u7801\u4E0D\u4E00\u81F4");return}const n={oldSk:yield f(e.editForm.oldSk,v),sk:yield f(e.editForm.sk,v)};(yield H(n)).statusCode==="200"&&(Z("\u4FEE\u6539\u6210\u529F\uFF0C\u8BF7\u91CD\u65B0\u767B\u5F55"),e.loginUserId="",e.password="",e.ak="",e.sk="",B())});function l(){D(document.querySelector(".user"),"focus")}function g(){e.loginUserId.length===0&&U(document.querySelector(".user"),"focus")}function V(){D(document.querySelector(".pwd"),"focus")}function R(){e.password.length===0&&U(document.querySelector(".pwd"),"focus")}return(n,i)=>{const t=q("motion");return m(),r(J,null,[s("img",{src:o($),class:"wave"},null,8,ee),s("img",{src:o(G),class:"login-image-title"},null,8,oe),s("div",te,[se,ie,s("img",{src:o(X),class:"login-image"},null,8,ue)]),s("div",ne,[s("div",ae,[s("div",le,[a((m(),r("div",re,ce)),[[t]]),a((m(),r("h2",me,_e)),[[t]]),a((m(),r("div",fe,[s("div",null,[a(s("input",{type:"text",class:"input",placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u540D","onUpdate:modelValue":i[0]||(i[0]=u=>o(e).loginUserId=u),onFocus:l,onBlur:g},null,544),[[E,o(e).loginUserId]])])])),[[t]]),a((m(),r("div",ye,[s("div",null,[a(s("input",{type:"password",class:"input",placeholder:"\u8BF7\u8F93\u5165\u5BC6\u7801","onUpdate:modelValue":i[1]||(i[1]=u=>o(e).password=u),onFocus:V,onBlur:R},null,544),[[E,o(e).password]])])])),[[t]]),a((m(),r("div",Fe,[d(o(Y),{modelValue:o(e).isChecked,"onUpdate:modelValue":i[2]||(i[2]=u=>o(e).isChecked=u),label:"\u8BB0\u4F4F\u5BC6\u7801"},null,8,["modelValue"])])),[[t]]),a((m(),r("button",{class:"btn",initial:{opacity:0,y:10},enter:{opacity:1,y:0,transition:{delay:400}},onClick:S},Ee)),[[t]]),a((m(),r("div",Be,he)),[[t]]),Ce])])]),d(o(z),{modelValue:o(e).visible,"onUpdate:modelValue":i[6]||(i[6]=u=>o(e).visible=u),"show-close":!1,title:"\u4FEE\u6539\u5BC6\u7801"},{footer:c(()=>[s("span",Se,[d(o(b),{onClick:B},{default:c(()=>[ve]),_:1}),d(o(b),{type:"primary",onClick:F},{default:c(()=>[Ie]),_:1})])]),default:c(()=>[d(o(Q),{model:o(e).editForm,"label-width":"120px",class:"edit-form"},{default:c(()=>[d(o(I),{label:"\u65E7\u5BC6\u7801"},{default:c(()=>[a(s("input",{"onUpdate:modelValue":i[3]||(i[3]=u=>o(e).editForm.oldSk=u),type:"password"},null,512),[[E,o(e).editForm.oldSk]])]),_:1}),d(o(I),{label:"\u65B0\u5BC6\u7801"},{default:c(()=>[a(s("input",{"onUpdate:modelValue":i[4]||(i[4]=u=>o(e).editForm.sk=u),type:"password"},null,512),[[E,o(e).editForm.sk]])]),_:1}),d(o(I),{label:"\u786E\u8BA4\u5BC6\u7801"},{default:c(()=>[a(s("input",{"onUpdate:modelValue":i[5]||(i[5]=u=>o(e).editForm.confirmSk=u),type:"password"},null,512),[[E,o(e).editForm.confirmSk]])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])],64)}}});var Me=N(Ae,[["__scopeId","data-v-7589b93f"],["__file","E:/project/\u4E3B\u5DE5\u7A0B/fin-main-app/src/views/login.vue"]]);export{Me as default};
