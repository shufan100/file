<!DOCTYPE html>
<html>
<head>
	<title>Vue3请求Hook</title>
</head>
<body>

</body>
</html>
<script type="text/javascript">

	import {ref, onMounted} from 'vue'

	// 请求封装
	function getBookList(params) {
    return new Promise((resolve,reject) => {
      axios.post('http://...',params).then(res=>{
      	resolve(res.data)
      },err=>{
				reject(err)
      })
    })
	}

	// 封装了获取资源、处理加载状态等逻辑
	function useApi(api) {
    const loading = ref(false)
    const result = ref(null)
    const error = ref(null)

    const fetchResource = (params) => {
      loading.value = true
      return api(params).then(res => {
          // 按照约定，api返回的结果直接复制给result
          result.value = res
      }).catch(err => {
          error.value = err
      }).finally(() => {
          loading.value = false
      })
    }
    return {
      loading,
      error,
      result,
      fetchResource
    }
	}


// vue3组件内使用useApi的hooks
	function useBook() {
    const {loading, error, result, fetchResource,} = useApi(fetchBookList)

    onMounted(() => {
        fetchResource({page: 1})
    })

    return {
        loading,
        error,
        list: result
    }
}

</script>