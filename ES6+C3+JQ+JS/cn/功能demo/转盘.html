<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>转盘游戏</title>
    <style>
      #canvas {
        width: 500px;
        height: 500px;
        margin: 50px auto;
        border: 1px solid #000;
      }
      #spin {
        margin-top: 20px;
        width: 100px;
        height: 50px;
        font-size: 20px;
      }
    </style>
  </head>
  <body>
    <canvas id="canvas"></canvas>
    <button id="spin">开始转动</button>

    <!-- <script src="script.js"></script> -->
  </body>
</html>
<script>
  const canvas = document.getElementById('canvas')
  const ctx = canvas.getContext('2d')

  // 设定转盘各个扇形的颜色
  const colors = ['#1abc9c', '#f1c40f', '#3498db', '#e74c3c', '#2980b9', '#2ecc71', '#e67e22', '#95a5a6', '#9b59b6', '#34495e']

  // 计算二分之一角度以便画弧
  const pi = Math.PI
  const arc = pi / 5

  // 绘制扇形
  function drawSector(x, y, r, color) {
    ctx.beginPath()
    ctx.moveTo(x, y)
    ctx.fillStyle = color
    ctx.arc(x, y, r, 0, 2 * pi, false)
    ctx.fill()
  }

  // 绘制文字
  function drawText(num, x, y) {
    ctx.font = 'bold 30px Arial'
    ctx.fillStyle = '#fff'
    ctx.textAlign = 'center'
    ctx.textBaseline = 'middle'
    ctx.fillText(num, x, y)
  }

  // 绘制转盘
  function drawWheel() {
    let startAngle = 0
    for (let i = 1; i <= 10; i++) {
      const x = canvas.width / 2
      const y = canvas.height / 2
      const radius = x - 50
      const endAngle = startAngle + arc
      drawSector(x, y, radius, colors[i - 1])
      drawText(i, x + (radius / 2) * Math.cos(startAngle + arc / 2), y + (radius / 2) * Math.sin(startAngle + arc / 2))
      startAngle = endAngle
    }
  }

  // 旋转转盘
  function spinWheel() {
    // 随机旋转圈数
    const spins = Math.floor(Math.random() * 10 + 10)
    // 随机停留在一个扇形的角度
    const stopAngle = Math.floor(Math.random() * 360)
    // 减速旋转时间
    const duration = 5000
    // 每 20ms 更新一次角度
    const interval = 20
    const step = 360 / (duration / interval)
    let currentAngle = 0
    let spinCount = 0
    let spinState = 'accelerate'

    // 动画循环
    const loop = setInterval(() => {
      // 加速旋转，转一圈后开始减速
      if (spinState === 'accelerate') {
        currentAngle += step
        if (currentAngle >= 360) {
          currentAngle = 0
          spinCount++
          // 已经旋转了指定圈数，开始减速旋转
          if (spinCount >= spins) {
            spinState = 'decelerate'
          }
        }
      }
      // 减速旋转，时间到了停下来
      else if (spinState === 'decelerate') {
        if (currentAngle < stopAngle) {
          currentAngle += step
        } else {
          clearInterval(loop)
        }
      }

      // 清空画布
      ctx.clearRect(0, 0, canvas.width, canvas.height)
      // 重新绘制转盘
      drawWheel()
      // 旋转画布
      ctx.translate(canvas.width / 2, canvas.height / 2)
      ctx.rotate((currentAngle * Math.PI) / 180)
      ctx.translate(-canvas.width / 2, -canvas.height / 2)
    }, interval)
  }

  // 绑定按钮点击事件
  const btn = document.getElementById('spin')
  btn.addEventListener('click', spinWheel)

  // 绘制转盘
  drawWheel()
</script>
